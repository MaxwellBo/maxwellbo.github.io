<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ruby</title>
  <script src="tracery.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script type="module">
  import { CelineModule, registerScriptReevaluationOnBlur } from 'https://esm.sh/jsr/@celine/celine@4.8.0';
  import * as Inputs from 'https://esm.run/@observablehq/inputs@0.12.0';
  import * as htl from 'https://esm.run/htl@0.3.1';

  window.celine = CelineModule.usingNewObservableRuntimeAndModule(document);
  window.library = celine.library; /* @observablehq/stdlib */
  window.Inputs = Inputs;
  window.htl = htl;

  registerScriptReevaluationOnBlur(document, /*class=*/'echo');
  </script>

  <link 
    rel="stylesheet" 
    href="https://esm.sh/jsr/@celine/celine@4.8.0/cell.css" />

  <style>
    pre {
      background-color: #f5f5f5;
      padding-top: 1em;
      padding-left: 1em;
      padding-right: 1em;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <h1>
    ruby
  </h1>

  <blockquote>
    The <code>&lt;ruby&gt;</code> HTML element represents small annotations that are rendered above, below, or next to
    base text, usually used for showing the pronunciation of East Asian characters. It can also be used for annotating
    other kinds of text, but this usage is less common.
  </blockquote>

  from <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ruby">MDN</a>

  <p>For example:</p>

  <pre>
    <code>
&lt;ruby&gt;
  明日 &lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;Ashita&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;
&lt;/ruby&gt;
    </code>
  </pre>

  <p>renders as</p>

  <ruby>明日 <rp>(</rp>
    <rt>Ashita</rt>
    <rp>)</rp>
  </ruby>

  <p>and</p>

  <pre>
    <code>
&lt;ruby&gt;
漢 &lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;Kan&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt; 字 &lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;ji&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;
&lt;/ruby&gt;
    </code>
  </pre>

  <p>renders as</p>

  <ruby>
    漢 <rp>(</rp>
    <rt>Kan</rt>
    <rp>)</rp> 字 <rp>(</rp>
    <rt>ji</rt>
    <rp>)</rp>
  </ruby>


  <p>Now I was curious as to whether you could nest <code>&lt;ruby&gt;</code> elements!</p>

  <p>You can!</p>
  <div id="exampletree">
<ruby>
  A
  <rt>
    <ruby>
      B1
      <rt>
        <ruby>
          C1
          <rt>D1</rt>
        </ruby>
        <ruby>
          C2
          <rt>D2</rt>
        </ruby>
      </rt>
    </ruby>
    <ruby>
      C1
      <rt>
        <ruby>
          D1
          <rt>
            <ruby>
              E1
            </ruby>
            <ruby>
              E2
            </ruby>
          </rt>
        </ruby>
      </rt>
    </ruby>
  </rt>
</ruby>
  </div>

  <p>This small tree is produced by the following HTML:</p>

  <pre>
    <code id="preview">

    </code>
  </pre>

  <script>
    document.getElementById('preview').textContent = document.getElementById('exampletree').innerHTML;
  </script>


</body>

<script id="viewof seed" type="module">
  celine.viewof('seed', () => {
    return Inputs.range([0, 100], {label: "seed", step: 1, value: 26 });
  });
</script>

<script class="echo" id="first" type="module" contenteditable="true">
  const grammarSource = {
    "nonterminal": [
      "<ruby> #terminal# <rt>#nonterminal# #nonterminal#  #terminal# </rt></ruby>",
      "#terminal#"
    ],
    "terminal": ["a"],
  }

  celine.cell('first', ['seed'], (seed) => {
    const grammar = tracery.createGrammar(grammarSource);
    tracery._randomSeed = seed;

    const output = grammar.flatten("#nonterminal#");
    const outputElement = document.createElement('div');
    outputElement.innerHTML = output;
    return outputElement;
  })
</script>

</html>