<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>ðŸŽ€ Lucy's skincare favorites ðŸŽ€</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');

    body {
      cursor: url(https://maxbo.me/cursors/cursors/c_9393.png), auto;
      font-family: 'Lexend', sans-serif;
      color: #363029;
      margin: 0 auto;
      padding: 0 1em;
      max-width: 100ch;
      background-color: #FECCE5;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Montserrat'
    }

    .grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(33ch, 1fr));
    }

    .favorite {
      border: 1px solid purple;
      padding: 1rem;
      border-radius: 8px;
    }

    .loading {
      font-size: 1.5em;
      text-align: center;
    }

    .hidden {
      display: none;
    }
  </style>
  <script type="module">
    import * as d3 from 'https://esm.sh/d3';
    import * as htl from 'https://esm.run/htl';

    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRzPtzQ6vNbxRJ9DDwWec1o36ClysOuaMk2zsKiiQphZ1L5tUVKvpe_fbsU8dyvmewAoIbdolD3y5wt/pub?gid=1157602938&single=true&output=csv";
    const CATEGORY_ORDER = [
      "1st Cleanser",
      "2nd Cleanser",
      "Mask",
      "Active",
      "Toner / Essence / Lotion",
      "Serum / Ampoule",
      "Moisturiser",
      "Oil",
      "Sunscreen",
      "Mist",
      "Lip Balm",
    ];

    function createFavoriteElement(favorite) {
      return htl.html.fragment`<article class="favorite">
        <small>${favorite.Category} - ${favorite["Sub-Category"]}</small>
        <p>
          <a href=${favorite["Referral Links"]}>
            ${favorite.Name} - <i>${favorite.Brand}</i>
          </a>
        </p>
        <p>${favorite.Comments}</p>
        <small>${favorite.Price} âˆ™ ${favorite.Rating}</small>
      </article>
      `;
    }

    function createGroupElement({ name, favorites }) {
      return htl.html.fragment`<section>
          <h2 id=${name}><a href="#${name}">#</a> ${name}</h2>
          <div class="grid">
            ${favorites.map(createFavoriteElement)}
          </div>
        </section>
      `;
    }

    async function fetchFavorites() {
      const loadingDiv = document.getElementById('loading');
      loadingDiv.classList.remove('hidden');

      try {
        const response = await fetch(csvUrl);
        const text = await response.text();
        const rejoined = text.split("\n").slice(3).join("\n");
        const favorites = d3.csvParse(rejoined);
        let groups = Object.fromEntries(Object.entries(Object.groupBy(favorites, f => f.Category)).sort(([a], [b]) => CATEGORY_ORDER.indexOf(a) - CATEGORY_ORDER.indexOf(b)));

        const nav = document.querySelector('nav ul');
        nav.append(...Object.keys(groups).map(name => htl.html`<li><a href="#${name}">${name}</a></li>`));

        const main = document.querySelector('main');
        main.append(...Object.entries(groups).map(([name, favorites]) => createGroupElement({ name, favorites })));
      } catch (error) {
        console.error('Error fetching favorites:', error);
      } finally {
        loadingDiv.classList.add('hidden');
      }
    }

    fetchFavorites();
  </script>
</head>

<body>
  <header>
    <h1>ðŸŽ€ Lucy's skincare favorites ðŸŽ€</h1>
  </header>
  <main>
    <nav>
      <ul></ul>
    </nav>
    <div id="loading" class="loading">Loading</div>
  </main>
  <footer>
    <small>
      c. 2024, content: <a href="https://linktr.ee/lucylivin">Lucy Livin</a>, site:
      <a href="https://maxbo.me">Max Bo</a>
    </small>
  </footer>
</body>

</html>