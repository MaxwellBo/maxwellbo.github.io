<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Distance map | YIMBY Melbourne Data</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/theme-yimby-melbourne.4dececa6.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="preload" as="style" href="./_npm/mapbox-gl@3.2.0/dist/mapbox-gl.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/theme-yimby-melbourne.4dececa6.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="./_npm/mapbox-gl@3.2.0/dist/mapbox-gl.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/deck.gl@9.0.9/dist.min.js._esm.js">
<link rel="modulepreload" href="./_npm/mapbox-gl@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/color-js@1.0.5/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.13/_esm.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.8.5/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/walkability_by_SAL.geojson", {"name":"./data/walkability_by_SAL.geojson","mimeType":"application/geo+json","path":"./_file/data/walkability_by_SAL.5a26cd74.geojson","lastModified":1713437326321});
registerFile("./data/walkability_by_node.geojson", {"name":"./data/walkability_by_node.geojson","mimeType":"application/geo+json","path":"./_file/data/walkability_by_node.4cc6529e.geojson","lastModified":1713488719519});

define({id: "387f62c1", inputs: ["FileAttachment"], outputs: ["walkability_by_node_geojson","walkability_by_SAL_geojson"], body: (FileAttachment) => {
const walkability_by_node_geojson = FileAttachment("./data/walkability_by_node.geojson").json();
// const walkability_by_SA1_geojson = FileAttachment("data/walkability_by_SA1.geojson").json()
// FIXME: We have to use the lower resolution SAL file because Observable doesn't support large files over 50mb. https://github.com/observablehq/framework/issues/1251
const walkability_by_SAL_geojson = FileAttachment("./data/walkability_by_SAL.geojson").json()
return {walkability_by_node_geojson,walkability_by_SAL_geojson};
}});

define({id: "daa29fb4", inputs: ["walkability_by_node_geojson","view","Inputs"], outputs: ["nodesHead","closestKeys","consideredKeys"], body: (walkability_by_node_geojson,view,Inputs) => {
const nodesHead = walkability_by_node_geojson.features[0].properties;
const closestKeys = Object.keys(nodesHead).filter(d => d.includes("closest"))
const consideredKeys = view(
  Inputs.checkbox(closestKeys, {
    sort: true,
    unique: true,
    value: ["restaurant - closest", "grocery or supermarket - closest", "cafe - closest", "bar or pub - closest", "park area - closest", "school - closest", "child care - closest", "medical facility - closest"],
    label: "Choose amenities you care about:",
    format: d => d.replace(" - closest", "")
  })
);
return {nodesHead,closestKeys,consideredKeys};
}});

define({id: "b786b124", inputs: ["consideredKeys"], outputs: ["MAX_DISTANCE","takeMax"], body: (consideredKeys) => {
const MAX_DISTANCE = 5000;

function takeMax(node) {
  // extract the values using the considered keys from the node
  const consideredValues = consideredKeys.map(key => node[key]).map(d => d || MAX_DISTANCE);
  return Math.max(...consideredValues);
}
return {MAX_DISTANCE,takeMax};
}});

define({id: "040cad5b", inline: true, inputs: ["plotWeeklyRentLegend","display"], body: async (plotWeeklyRentLegend,display) => {
display(await(
plotWeeklyRentLegend()
))
}});

define({id: "71e81d69", inline: true, inputs: ["plotDistanceLegend","display"], body: async (plotDistanceLegend,display) => {
display(await(
plotDistanceLegend()
))
}});

define({id: "3080cffd", outputs: ["deck","mapboxgl","Color","DeckGL","AmbientLight","GeoJsonLayer","ColumnLayer","LightingEffect","PointLight"], body: async () => {
const [{default: deck}, {default: mapboxgl}, {default: Color}] = await Promise.all([import("./_npm/deck.gl@9.0.9/dist.min.js._esm.js"), import("./_npm/mapbox-gl@3.2.0/_esm.js"), import("./_npm/color-js@1.0.5/_esm.js")]);
const {DeckGL, AmbientLight, GeoJsonLayer, ColumnLayer, LightingEffect, PointLight} = deck;
return {deck,mapboxgl,Color,DeckGL,AmbientLight,GeoJsonLayer,ColumnLayer,LightingEffect,PointLight};
}});

define({id: "ad5193d1", inputs: ["topojson"], outputs: ["topo","world","countries"], body: (topojson) => {
// https://observablehq.com/@visionscarto/world-atlas-topojson#files
const topo = new URL("./_npm/visionscarto-world-atlas@1.0.0/world/50m.json", location).href;
const world = fetch(topo).then((response) => response.json());
const countries = world.then((world) => topojson.feature(world, world.objects.countries));
return {topo,world,countries};
}});

define({id: "505d4520", inputs: ["DeckGL","container","LightingEffect","AmbientLight","PointLight","mapboxgl","GeoJsonLayer","walkability_by_SAL_geojson","weeklyRentPlot","Color","ColumnLayer","walkability_by_node_geojson","MAX_DISTANCE","takeMax","distancePlot","invalidation"], outputs: ["MELBOURNE_CBD_LAT_LON","deckInstance"], body: (DeckGL,container,LightingEffect,AmbientLight,PointLight,mapboxgl,GeoJsonLayer,walkability_by_SAL_geojson,weeklyRentPlot,Color,ColumnLayer,walkability_by_node_geojson,MAX_DISTANCE,takeMax,distancePlot,invalidation) => {
// Melbourne CBD
const MELBOURNE_CBD_LAT_LON = [-37.8136, 144.9631];

const deckInstance = new DeckGL({
  container,
  initialViewState: {
    longitude: MELBOURNE_CBD_LAT_LON[1],
    latitude: MELBOURNE_CBD_LAT_LON[0],
    zoom: 10,
    minZoom: 5,
    maxZoom: 15,
    pitch: 40.5,
    bearing: 0
  },
  getTooltip: ({ object }) => {
    if (!object) return null;
    const [lng, lat] = object.position;
    return `latitude: ${lat.toFixed(2)}
      longitude: ${lng.toFixed(2)}
    `;
  },
  effects: [
    new LightingEffect({
      ambientLight: new AmbientLight({color: [255, 255, 255], intensity: 1.0}),
      pointLight: new PointLight({color: [255, 255, 255], intensity: 0.8, position: [-0.144528, 49.739968, 80000]}),
      pointLight2: new PointLight({color: [255, 255, 255], intensity: 0.8, position: [-3.807751, 54.104682, 8000]})
    })
  ],
  controller: true,
  map: mapboxgl,
  mapboxApiAccessToken: "pk.eyJ1IjoibWF4Ym8iLCJhIjoiY2lsd2JnZDRyMDFxNHZna3MwZDZmN2R0ZCJ9.32XWATCazaiDzdW6bXvBxw",
  mapStyle: "mapbox://styles/mapbox/light-v10",
  layers: [
    // Add the rent layer
    new GeoJsonLayer({
      id: "rent",
      data: walkability_by_SAL_geojson,
      opacity: 0.5,
      stroked: false,
      filled: true,
      wireframe: true,
      getElevation: (f) => f.properties.median_rent_weekly / 10,
      getFillColor: (f) => {
        const hex = weeklyRentPlot.scale("color").apply(f.properties.median_rent_weekly)
        const color = Color(hex);
        return [color.red * 255, color.green * 255, color.blue * 255]
      },
      getLineColor: [255, 255, 255],
    }),
    // Add the node layer as a ColumnLayer
    new ColumnLayer({
      id: "nodes",
      data: [...walkability_by_node_geojson.features],
      radius: 100,
      elevationScale: 0.2,
      opacity: 0.5,
      extruded: true,
      coverage: 1,
      getPosition: (f) => f.geometry.coordinates,
      getElevation: (f) => MAX_DISTANCE - takeMax(f.properties),
      getColor: (f) => {
        const hex = distancePlot.scale("color").apply(takeMax(f.properties));
        const color = Color(hex);
        return [color.red * 255, color.green * 255, color.blue * 255]
      },
    }),
  ]
});

// clean up if this code re-runs
invalidation.then(() => {
  deckInstance.finalize();
  container.innerHTML = "";
});
return {MELBOURNE_CBD_LAT_LON,deckInstance};
}});

define({id: "eca7fdc6", inputs: ["Plot","MAX_DISTANCE","walkability_by_node_geojson","takeMax","view"], outputs: ["DISTANCE_LEGEND_LABEL","distancePlot","plotDistanceLegend"], body: (Plot,MAX_DISTANCE,walkability_by_node_geojson,takeMax,view) => {
const DISTANCE_LEGEND_LABEL = "Max distance to a desired amenity (m)";

const distancePlot = Plot.plot({
    grid: true,
    aspectRatio: 1,
    color: {
      domain: [0, MAX_DISTANCE],
      legend: true,
      scheme: "turbo",
      label: DISTANCE_LEGEND_LABEL
    },
    marks: [
      Plot.geo(walkability_by_node_geojson, {
        fill: (d) => takeMax(d.properties),
        tip: true
      }),
    ],
  })

view(distancePlot)

function plotDistanceLegend() {
  return Plot.legend({
    color: distancePlot.scale("color"),
    label: DISTANCE_LEGEND_LABEL
  })
}
return {DISTANCE_LEGEND_LABEL,distancePlot,plotDistanceLegend};
}});

define({id: "60bcf9a5", inputs: ["Plot","walkability_by_SAL_geojson","view"], outputs: ["WEEKLY_RENT_LEGEND_LABEL","weeklyRentPlot","plotWeeklyRentLegend"], body: (Plot,walkability_by_SAL_geojson,view) => {
const WEEKLY_RENT_LEGEND_LABEL = "Median rent, weekly ($)";

const weeklyRentPlot  = Plot.plot({
    grid: true,
    aspectRatio: 1,
    color: {
      domain: [0, 1200],
      legend: true,
      label: WEEKLY_RENT_LEGEND_LABEL,
      scheme: "plasma",
    },
    marks: [
      Plot.geo(walkability_by_SAL_geojson, {
        fill: (d) => d.properties.median_rent_weekly,
        tip: { channels: { name: (d) => d.properties.geography_name } },
      }),
    ],
  })

view(weeklyRentPlot)

function plotWeeklyRentLegend() {
  return Plot.legend({
    color: weeklyRentPlot.scale("color"),
    label: WEEKLY_RENT_LEGEND_LABEL
  })
}
return {WEEKLY_RENT_LEGEND_LABEL,weeklyRentPlot,plotWeeklyRentLegend};
}});

define({id: "6b33e563", inline: true, inputs: ["distancePlot","display"], body: async (distancePlot,display) => {
display(await(
distancePlot
))
}});

define({id: "6bcadbc0", inline: true, inputs: ["weeklyRentPlot","display"], body: async (weeklyRentPlot,display) => {
display(await(
weeklyRentPlot
))
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">YIMBY Melbourne Data</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./walkability">Walkability</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./distance">Maximum distance to desired amenities</a></li>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type), h2:first-child, :not(h1) + h2">
<nav>
</nav>
</aside>
<div id="observablehq-center">
<header id="observablehq-header">
<a href="https://www.yimby.melbourne/" target="_blank" rel="noopener noreferrer"><img src="https://assets-global.website-files.com/64a530aa67ffbab04c9c39ab/64b27aa3f510a34fa5003e6a_logo_inter.svg" height="50/"></a>
</header>
<main id="observablehq-main" class="observablehq">
<h1 id="maximum-distance-to-desired-amenities" tabindex="-1"><a class="observablehq-header-anchor" href="#maximum-distance-to-desired-amenities">Maximum distance to desired amenities</a></h1>
<p>A Melbourne specific clone of <a href="https://close.city/" target="_blank" rel="noopener noreferrer">close.city</a>.</p>
<div id="cell-387f62c1" class="observablehq observablehq--block"></div>
<div id="cell-daa29fb4" class="observablehq observablehq--block"></div>
<div id="cell-b786b124" class="observablehq observablehq--block"></div>
<div class="card" style="margin: 0 -1rem;">
<figure style="max-width: none; position: relative;">
  <div id="container" style="border-radius: 8px; overflow: hidden; background: rgb(18, 35, 48); height: 800px; margin: 1rem 0; "></div>
  <div style="position: absolute; top: 1rem; right: 1rem; filter: drop-shadow(0 0 4px rgba(0,0,0,.5));"><span id="cell-040cad5b" class="observablehq--loading"></span></div>
  <div style="position: absolute; top: 4rem; right: 1rem; filter: drop-shadow(0 0 4px rgba(0,0,0,.5));"><span id="cell-71e81d69" class="observablehq--loading"></span></div>
  <figcaption>Data: <a href="">TODO</a></figcaption>
</figure>
</div>
<div id="cell-3080cffd" class="observablehq observablehq--block"></div>
<div id="cell-ad5193d1" class="observablehq observablehq--block"></div>
<div id="cell-505d4520" class="observablehq observablehq--block"></div>
<div id="cell-eca7fdc6" class="observablehq observablehq--block"></div>
<div id="cell-60bcf9a5" class="observablehq observablehq--block"></div>
<div class="grid grid-cols-2">
  <div class="card" style="max-width: 640px;">
    <span id="cell-6b33e563" class="observablehq--loading"></span>
  </div>
  <div class="card" style="max-width: 640px;">
    <span id="cell-6bcadbc0" class="observablehq--loading"></span>
  </div>
</div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./walkability"><span>Walkability</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-04-19T15:09:56">Apr 19, 2024</a>.</div>
</footer>
</div>
