/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@uwdata/mosaic-inputs@0.7.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{coordinator as t,MosaicClient as e,isSelection as s,isParam as i}from"../mosaic-core@0.7.0/_esm.js";import{eq as n,literal as l,Query as r,contains as h,prefix as o,suffix as a,regexp_matches as u,min as c,max as d,column as m,desc as p}from"../mosaic-sql@0.7.0/_esm.js";import{format as f}from"../../isoformat@0.2.1/_esm.js";function b(e,s){const i=new e(s);return t().connect(i),i.element}const v=t=>b(x,t);class x extends e{constructor({element:t,filterBy:e,from:i,column:n,label:l=n,format:r=(t=>t),options:h,value:o,as:a}={}){super(e),this.from=i,this.column=n,this.selection=a,this.format=r,this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),this.element.value=this;const u=document.createElement("label");u.innerText=l||n,this.element.appendChild(u),this.select=document.createElement("select"),h&&(this.data=h.map((t=>{return(e=t)&&"object"==typeof e&&!Array.isArray(e)?t:{value:t};var e})),this.update()),o=o??this.selection?.value??this.data?.[0]?.value,void 0===this.selection?.value&&this.publish(o),this.element.appendChild(this.select),this.selection&&(this.select.addEventListener("input",(()=>{this.publish(this.selectedValue()??null)})),s(this.selection)||this.selection.addEventListener("value",(t=>{t!==this.select.value&&this.selectedValue(t)})))}selectedValue(t){if(0===arguments.length){const t=this.select.selectedIndex;return this.data[t].value}{const e=this.data?.findIndex((e=>e.value===t));e>=0?this.select.selectedIndex=e:this.select.value=String(t)}}reset(){this.select.selectedIndex=this.from?0:-1}publish(t){const{selection:e,column:r}=this;s(e)?e.update({source:this,schema:{type:"point"},value:t,predicate:""!==t&&void 0!==t?n(r,l(t)):null}):i(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?r.from(e).select({value:s}).distinct().where(t).orderby(s):null}queryResult(t){return this.data=[{value:"",label:"All"},...t],this}update(){const{data:t,format:e,select:s}=this;s.replaceChildren();for(const{value:s,label:i}of t){const t=document.createElement("option");t.setAttribute("value",s),t.innerText=i??e(s),this.select.appendChild(t)}return this.selection&&this.selectedValue(this.selection?.value??""),this}}const y={contains:h,prefix:o,suffix:a,regexp:u};let C=0;const E=t=>b(A,t);class A extends e{constructor({element:t,filterBy:e,from:i,column:n,label:l,type:r="contains",as:h}={}){if(super(e),this.id="search_"+ ++C,this.type=r,this.from=i,this.column=n,this.selection=h,this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),this.element.value=this,l){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=l,this.element.appendChild(t)}this.searchbox=document.createElement("input"),this.searchbox.setAttribute("id",this.id),this.searchbox.setAttribute("type","text"),this.searchbox.setAttribute("placeholder","Query"),this.element.appendChild(this.searchbox),this.selection&&(this.searchbox.addEventListener("input",(()=>{this.publish(this.searchbox.value||null)})),s(this.selection)||this.selection.addEventListener("value",(t=>{t!==this.searchbox.value&&(this.searchbox.value=t)})))}reset(){this.searchbox.value=""}publish(t){const{selection:e,column:n,type:r}=this;s(e)?e.update({source:this,schema:{type:r},value:t,predicate:t?y[r](n,l(t)):null}):i(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?r.from(e).select({list:s}).distinct().where(t):null}queryResult(t){return this.data=t,this}update(){const t=document.createElement("datalist"),e=`${this.id}_list`;t.setAttribute("id",e);for(const e of this.data){const s=document.createElement("option");s.setAttribute("value",e.list),t.append(s)}return this.datalist&&this.datalist.remove(),this.element.appendChild(this.datalist=t),this.searchbox.setAttribute("list",e),this}}let g=0;const w=t=>b(q,t);class q extends e{constructor({element:t,filterBy:e,as:i,min:n,max:l,step:r,from:h,column:o,label:a=o,value:u=i?.value,width:c}={}){if(super(e),this.id="slider_"+ ++g,this.from=h,this.column=o||"value",this.selection=i,this.min=n,this.max=l,this.step=r,this.element=t||document.createElement("div"),this.element.setAttribute("class","input"),this.element.value=this,a){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=a,this.element.appendChild(t)}this.slider=document.createElement("input"),this.slider.setAttribute("id",this.id),this.slider.setAttribute("type","range"),null!=c&&(this.slider.style.width=+c+"px"),null!=n&&this.slider.setAttribute("min",n),null!=l&&this.slider.setAttribute("max",l),null!=r&&this.slider.setAttribute("step",r),null!=u&&(this.slider.setAttribute("value",u),void 0===this.selection?.value&&this.publish(u)),this.element.appendChild(this.slider),this.selection&&(this.slider.addEventListener("input",(()=>{this.publish(+this.slider.value)})),s(this.selection)||this.selection.addEventListener("value",(t=>{t!==+this.slider.value&&(this.slider.value=t)})))}query(t=[]){const{from:e,column:s}=this;return!e||null!=this.min&&null!=this.max?null:r.select({min:c(s),max:d(s)}).from(e).where(t)}queryResult(t){const{min:e,max:s}=Array.from(t)[0];return null==this.min&&this.slider.setAttribute("min",e),null==this.max&&this.slider.setAttribute("max",s),null==this.step&&this.slider.setAttribute("step",(s-e)/500),this}publish(t){const{selection:e,column:r}=this;s(e)?e.update({source:this,schema:{type:"point"},value:t,predicate:n(r,l(t))}):i(this.selection)&&e.update(t)}}const $=T((t=>{const e=D(t);return t=>null==t?"":"number"==typeof t?e(t):t instanceof Date?L(t):`${t}`})),D=T((t=>e=>0===e?"0":e.toLocaleString(t)));function L(t){return f(t,"Invalid Date")}function T(t){let e,s=T;return(i="en")=>i===s?e:e=t(s=i)}$(),D();let H=-1;const B=t=>b(I,t);class I extends e{constructor({element:t,filterBy:e,from:s,columns:i=["*"],align:n={},format:l,width:r,maxWidth:h,height:o=500,rowBatch:a=100}={}){super(e),this.id="table-"+ ++H,this.from=s,this.columns=i,this.format=l,this.align=n,this.widths="object"==typeof r?r:{},this.offset=0,this.limit=+a,this.pending=!1,this.sortHeader=null,this.sortColumn=null,this.sortDesc=!1,this.element=t||document.createElement("div"),this.element.setAttribute("id",this.id),this.element.value=this,"number"==typeof r&&(this.element.style.width=`${r}px`),h&&(this.element.style.maxWidth=`${h}px`),this.element.style.maxHeight=`${o}px`,this.element.style.overflow="auto";let u=-1;this.element.addEventListener("scroll",(t=>{const{pending:e,loaded:s}=this,{scrollHeight:i,scrollTop:n,clientHeight:l}=t.target,r=n<u;u=n,r||e||s||i-n<2*l&&(this.pending=!0,this.requestData(this.offset+this.limit))})),this.tbl=document.createElement("table"),this.element.appendChild(this.tbl),this.head=document.createElement("thead"),this.tbl.appendChild(this.head),this.body=document.createElement("tbody"),this.tbl.appendChild(this.body),this.style=document.createElement("style"),this.element.appendChild(this.style)}requestData(e=0){this.offset=e;const s=this.query(this.filterBy?.predicate(this));this.requestQuery(s),t().prefetch(s.clone().offset(e+this.limit))}fields(){return this.columns.map((t=>m(this.from,t)))}fieldInfo(t){this.schema=t;const e=this.head;e.innerHTML="";const s=document.createElement("tr");for(const{column:e}of t){const t=document.createElement("th");t.addEventListener("click",(t=>this.sort(t,e))),t.appendChild(document.createElement("span")),t.appendChild(document.createTextNode(e)),s.appendChild(t)}return e.appendChild(s),this.formats=function(t={},e,s){return e.map((({column:e,type:i})=>{if(e in t)return t[e];switch(i){case"number":return D(s);case"date":return L;default:return $(s)}}))}(this.format,t),this.style.innerText=function(t,e,s){const i=[];return e.forEach(((e,n)=>{const l=+s[n];if("left"!==e||l){const s="left"!==e?`text-align:${e};`:"",r=l?`width:${l}px;max-width:${l}px;`:"";i.push(`#${t} tr>:nth-child(${n+1}) {${s}${r}}`)}})),i.join(" ")}(this.id,function(t={},e){return e.map((({column:e,type:s})=>e in t?t[e]:"number"===s?"right":"left"))}(this.align,t),function(t={},e){return e.map((({column:e})=>t[e]))}(this.widths,t)),this}query(t=[]){const{from:e,limit:s,offset:i,schema:n,sortColumn:l,sortDesc:h}=this;return r.from(e).select(n.map((t=>t.column))).where(t).orderby(l?h?p(l):l:[]).limit(s).offset(i)}queryResult(t){return this.pending||(this.loaded=!1,this.body.replaceChildren()),this.data=t,this}update(){const{body:t,formats:e,data:s,schema:i,limit:n}=this,l=i.length;let r=0;for(const n of s){++r;const s=document.createElement("tr");for(let t=0;t<l;++t){const l=n[i[t].column],r=document.createElement("td");r.innerText=null==l?"":e[t](l),s.appendChild(r)}t.appendChild(s)}return r<n&&(this.loaded=!0),this.pending=!1,this}sort(t,e){e===this.sortColumn?this.sortDesc=!this.sortDesc:(this.sortColumn=e,this.sortDesc=!1);const s=t.currentTarget,i=this.sortHeader;i===s&&t.metaKey?(i.firstChild.textContent="",this.sortHeader=null,this.sortColumn=null):(i&&(i.firstChild.textContent=""),this.sortHeader=s,s.firstChild.textContent=this.sortDesc?"▾":"▴"),this.requestData()}}export{x as Menu,A as Search,q as Slider,I as Table,v as menu,E as search,w as slider,B as table};export default null;
