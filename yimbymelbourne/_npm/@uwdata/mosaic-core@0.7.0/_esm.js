/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@uwdata/mosaic-core@0.7.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{tableFromIPC as e}from"../../apache-arrow@15.0.1/_esm.js";import{create as t,Query as r,scaleTransform as n,sql as s,isBetween as i,and as o,Ref as c,isDescribeQuery as a,asRelation as l,count as u,max as h,min as f,isNull as d,or as p}from"../mosaic-sql@0.7.0/_esm.js";import*as m from"../../@duckdb/duckdb-wasm@1.28.0/_esm.js";const y={};function g(e,t=!1){let r,n,s=y;function i(t){r=e(t).then((()=>{if(n){const{value:e}=n;n=null,i(e)}else r=null}))}function o(e){r?function(e){n={event:e}}(e):i(e)}return t?function(e){s!==e&&requestAnimationFrame((()=>{const e=s;s=y,o(e)})),s=e}:o}class v{constructor(e){this._filterBy=e,this._requestUpdate=g((()=>this.requestQuery()),!0),this._coordinator=null}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get filterBy(){return this._filterBy}get filterIndexable(){return!0}fields(){return null}fieldInfo(){return this}query(){return null}queryPending(){return this}queryResult(){return this}queryError(e){return console.error(e),this}requestQuery(e){const t=e||this.query(this.filterBy?.predicate(this));return this._coordinator.requestQuery(this,t)}requestUpdate(){this._requestUpdate()}update(){return this}}function w(t="ws://localhost:3000/"){const r=[];let n,s=!1,i=null;const o={open(){s=!0,a()},close(){for(s=!1,i=null,n=null;r.length;)r.shift().reject("Socket closed")},error(e){if(i){const{reject:t}=i;i=null,a(),t(e)}else console.error("WebSocket error: ",e)},message({data:t}){if(i){const{query:r,resolve:n,reject:s}=i;if(i=null,a(),"string"==typeof t){const e=JSON.parse(t);e.error?s(e.error):n(e)}else if("exec"===r.type)n();else{if("arrow"!==r.type)throw new Error(`Unexpected socket data: ${t}`);n(e(t.arrayBuffer()))}}else console.log("WebSocket message: ",t)}};function c(e,c,l){null==n&&function(){n=new WebSocket(t);for(const e in o)n.addEventListener(e,o[e])}(),r.push({query:e,resolve:c,reject:l}),s&&!i&&a()}function a(){r.length&&(i=r.shift(),n.send(JSON.stringify(i.query)))}return{get connected(){return s},query:e=>new Promise(((t,r)=>c(e,t,r)))}}function q(e){let t=2166136261;for(let r=0,n=e.length;r<n;++r){const n=e.charCodeAt(r),s=65280&n;s&&(t=b(t^s>>8)),t=b(t^255&n)}return function(e){return e+=e<<13,e^=e>>>7,e+=e<<3,e^=e>>>17,e+=e<<5,4294967295&e}(t)}function b(e){return e+(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24)}class E{constructor(e,{selection:t,temp:r=!0}){this.mc=e,this.selection=t,this.temp=r,this.reset()}reset(){this.enabled=!1,this.clients=null,this.indices=null,this.activeView=null}clear(){this.indices&&(this.mc.cancel(Array.from(this.indices.values(),(e=>e.result))),this.indices=null)}index(e,r){if(this.clients!==e){const t=Array.from(e,x),r=t[0]?.from;this.enabled=t.every((e=>e&&e.from===r)),this.clients=e,this.activeView=null,this.clear()}if(!this.enabled)return!1;r=r||this.selection.active;const{source:c}=r;if(c&&c===this.activeView?.source)return!0;if(this.clear(),!c)return!1;const a=this.activeView=function(e){const{source:t,schema:r}=e;let c=e.predicate?.columns;if(!r||!c)return null;const{type:a,scales:l,pixelSize:u=1}=r;let h;if("interval"===a&&l){const t=l.map((e=>function(e,t){const{apply:r,sqlApply:i}=n(e);if(r){const{domain:n,range:o}=e,c=r(Math.min(...n)),a=r(Math.max(...n)),l=Math.abs(o[1]-o[0])/(a-c)/t,u=1===t?"":`${t}::INTEGER * `;return e=>s`${u}FLOOR(${l}::DOUBLE * (${i(e)} - ${c}::DOUBLE))::INTEGER`}}(e,u)));if(t.some((e=>null==e)))return null;1===t.length?(h=e=>e?i("active0",e.range.map(t[0])):[],c={active0:t[0](e.predicate.field)}):(h=e=>e?o(e.children.map((({range:e},r)=>i(`active${r}`,e.map(t[r]))))):[],c=Object.fromEntries(e.predicate.children.map(((e,r)=>[`active${r}`,t[r](e.field)]))))}else{if("point"!==a)return null;h=e=>e,c=Object.fromEntries(c.map((e=>[e.toString(),e])))}return{source:t,columns:c,predicate:h}}(r);if(!a)return!1;this.mc.logger().warn("DATA CUBE INDEX CONSTRUCTION");const l=this.selection.remove(c),u=this.indices=new Map,{mc:h,temp:f}=this;for(const n of e){if(l.skip(n,r))continue;const e=x(n),s=n.query(l.predicate(n)).select({...a.columns,...e.count}).groupby(Object.keys(a.columns)),[i]=s.subqueries;if(i){T(i,Object.values(a.columns).map((e=>e.columns[0])))}const o=s.orderby();s.query.orderby=[];const c=s.toString(),d=`cube_index_${(q(c)>>>0).toString(16)}`,p=h.exec(t(d,c,{temp:f}));u.set(n,{table:d,result:p,order:o,...e})}}async update(){const{clients:e,selection:t,activeView:r}=this,n=r.predicate(t.active.predicate);return Promise.all(Array.from(e).map((e=>this.updateClient(e,n))))}async updateClient(e,t){const n=this.indices.get(e);if(!n)return;t||(t=this.activeView.predicate(this.selection.active.predicate));const{table:s,dims:i,aggr:o,order:c=[]}=n,a=r.select(i,o).from(s).groupby(i).where(t).orderby(c);return this.mc.updateClient(e,a)}}const _={from:NaN};function x(e){if(!e.filterIndexable)return _;const t=e.query(),r=A(t);if(!r||!t.groupby)return _;const n=new Set(t.groupby().map((e=>e.column))),i=[],o=[];let c;for(const{as:e,expr:{aggregate:r}}of t.select())switch(r?.toUpperCase?.()){case"COUNT":case"SUM":i.push({[e]:s`SUM("${e}")::DOUBLE`});break;case"AVG":c="_count_",i.push({[e]:s`(SUM("${e}" * ${c}) / SUM(${c}))::DOUBLE`});break;case"MAX":i.push({[e]:s`MAX("${e}")`});break;case"MIN":i.push({[e]:s`MIN("${e}")`});break;default:if(!n.has(e))return null;o.push(e)}return{aggr:i,dims:o,count:c?{[c]:s`COUNT(*)`}:{},from:r}}function A(e){const t=e.subqueries;if(e.select){const r=e.from();if(!r.length)return;if(0===t.length)return r[0].from.table}const r=A(t[0]);for(let e=1;e<t.length;++e){const n=A(t[e]);if(void 0!==n&&n!==r)return NaN}return r}function T(e,t){const r=new Set,n=e=>{r.has(e)||(r.add(e),e.select&&e.from().length&&e.select(t),e.subqueries.forEach(n))};n(e)}class I{constructor(e,t,r=!0){this.mc=e,this.selection=t,this.clients=new Set,this.indexer=r?new E(this.mc,{...r,selection:t}):null;const{value:n,activate:s}=this.handlers={value:()=>this.update(),activate:e=>this.indexer?.index(this.clients,e)};t.addEventListener("value",n),t.addEventListener("activate",s)}finalize(){const{value:e,activate:t}=this.handlers;this.selection.removeEventListener("value",e),this.selection.removeEventListener("activate",t)}reset(){this.indexer?.reset()}add(e){return(this.clients=new Set(this.clients)).add(e),this}remove(e){return this.clients.has(e)&&(this.clients=new Set(this.clients)).delete(e),this}update(){const{mc:e,indexer:t,clients:r,selection:n}=this;return t?.index(r)?t.update():function(e,t,r){return Promise.all(Array.from(t).map((t=>{const n=r.predicate(t);if(null!=n)return e.updateClient(t,t.query(n))})))}(e,r,n)}}function N(){let e,t;const r=new Promise(((r,n)=>{e=r,t=n}));return r.fulfill=t=>(e(t),r),r.reject=e=>(t(e),r),r}function S(e,t,r){let n=[],s=0;function i(){const i=function(e,t){const r=[],n=new Map;for(const s of e){const{entry:{request:e}}=s,i=k(e.query,t);if(!n.has(i)){const e=[];r.push(e),n.set(i,e)}n.get(i).push(s)}return r}(n,t);n=[],s=0;for(const n of i)M(n,e,r),$(n,t)}return{add(t,r){"arrow"===t.request.type?(s=s||("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:setTimeout)((()=>i())),n.push({entry:t,priority:r,index:n.length})):e(t,r)}}}function k(e,t){const n=`${e}`;if(e instanceof r&&!t.get(n)){if(e.orderby().length||e.where().length||e.qualify().length||e.having().length)return n;const t=e.clone().$select("*"),r=e.groupby();if(r.length){const n={};e.select().forEach((({as:e,expr:t})=>n[e]=t)),t.$groupby(r.map((e=>e instanceof c&&n[e.column]||e)))}return`${t}`}return n}function M(e,t,r){if(function(e){if(e.length>1){const t=`${e[0].entry.request.query}`;for(let r=1;r<e.length;++r)if(t!==`${e[r].entry.request.query}`)return!0}return!1}(e))t({request:{type:"arrow",cache:!1,record:!1,query:e.query=L(e,r)},result:e.result=N()});else for(const{entry:r,priority:n}of e)t(r,n)}function L(e,t){const r=e.maps=[],n=new Map;for(const s of e){const{query:e}=s.entry.request,i=[];r.push(i);for(const{as:t,expr:r}of e.select()){const e=`${r}`;n.has(e)||n.set(e,[`col${n.size}`,r]);const[s]=n.get(e);i.push([s,t])}t(`${e}`)}const s=e[0].entry.request.query.clone(),i=s.groupby();if(i.length){const t={};e.maps[0].forEach((([e,r])=>t[r]=e)),s.$groupby(i.map((e=>e instanceof c&&t[e.column]||e)))}return s.$select(Array.from(n.values()))}async function $(e,t){const{maps:r,query:n,result:s}=e;if(!r)return;let i;try{i=await s}catch(t){for(const{entry:r}of e)r.result.reject(t);return}const o=a(n);e.forEach((({entry:e},n)=>{const{request:s,result:c}=e,a=r[n],l=o&&a?function(e,t){const r=new Map(t),n=[];for(const t of e)r.has(t.column_name)&&n.push({...t,column_name:r.get(t.column_name)});return n}(i,a):a?function(e,t){const r={};for(const[n,s]of t)r[s]=e.getChild(n);return new e.constructor(r)}(i,a):i;s.cache&&t.set(String(s.query),l),c.fulfill(l)}))}const C="undefined"!=typeof requestIdleCallback?requestIdleCallback:setTimeout;const U={High:0,Normal:1,Low:2};function B(){const e=function(e){const t=Array.from({length:e},(()=>({head:null,tail:null})));return{isEmpty:()=>t.every((e=>!e.head)),insert(e,r){const n=t[r];if(!n)throw new Error(`Invalid queue priority rank: ${r}`);const s={item:e,next:null};null===n.head?n.head=n.tail=s:n.tail=n.tail.next=s},remove(e){for(const r of t){let{head:t,tail:n}=r;for(let r=null,s=t;s;r=s,s=s.next)e(s.item)&&(s===t?t=s.next:r.next=s.next,s===n&&(n=r||t));r.head=t,r.tail=n}},next(){for(const e of t){const{head:t}=e;if(null!==t)return e.head=t.next,e.tail===t&&(e.tail=null),t.item}}}}(3);let t,r,n,s,i=[],o=null;function c(){if(o||e.isEmpty())return;const{request:s,result:i}=e.next();o=async function(e,s){try{const{query:i,type:o,cache:c=!1,record:a=!0,options:u}=e,h=i?`${i}`:null;if(a&&l(h),c){const e=r.get(h);if(e)return n.debug("Cache"),void s.fulfill(e)}const f=performance.now(),d=await t.query({type:o,sql:h,...u});c&&r.set(h,d),n.debug(`Request: ${(performance.now()-f).toFixed(1)}`),s.fulfill(d)}catch(e){s.reject(e)}}(s,i),o.finally((()=>{o=null,c()}))}function a(t,r=U.Normal){e.insert(t,r),c()}function l(e){i.length&&e&&i.forEach((t=>t.add(e)))}return{cache:e=>void 0!==e?r=!0===e?function({max:e=1e3,ttl:t=108e5}={}){let r=new Map;function n(){const e=performance.now()-t;let n=null,s=1/0;for(const[t,i]of r){const{last:o}=i;o<s&&(n=t,s=o),e>o&&r.delete(t)}n&&r.delete(n)}return{get(e){const t=r.get(e);if(t)return t.last=performance.now(),t.value},set:(t,s)=>(r.set(t,{last:performance.now(),value:s}),r.size>e&&C(n),s),clear(){r=new Map}}}():e||{get:()=>{},set:(e,t)=>t,clear:()=>{}}:r,logger:e=>e?n=e:n,connector:e=>e?t=e:t,consolidate(e){e&&!s?s=S(a,r,l):!e&&s&&(s=null)},request(e,t=U.Normal){const r=N(),n={request:e,result:r};return s?s.add(n,t):a(n,t),r},cancel(t){const r=new Set(t);e.remove((({result:e})=>r.has(e)))},clear(){e.remove((({result:e})=>(e.reject("Cleared"),!0)))},record(){let e=[];const t={add(t){e.push(t)},reset(){e=[]},snapshot:()=>e.slice(),stop:()=>(i=i.filter((e=>e!==t)),e)};return i.push(t),t}}}function O(e){switch(e){case"BIGINT":case"HUGEINT":case"INTEGER":case"SMALLINT":case"TINYINT":case"UBIGINT":case"UINTEGER":case"USMALLINT":case"UTINYINT":case"DOUBLE":case"FLOAT":case"REAL":return"number";case"DATE":case"TIMESTAMP":case"TIMESTAMPTZ":case"TIMESTAMP WITH TIME ZONE":case"TIME":case"TIMESTAMP_NS":return"date";case"BOOLEAN":return"boolean";case"VARCHAR":case"UUID":return"string";case"ARRAY":case"LIST":return"array";case"BLOB":case"STRUCT":case"MAP":case"GEOMETRY":return"object";default:if(e.startsWith("DECIMAL"))return"number";if(e.startsWith("STRUCT")||e.startsWith("MAP"))return"object";if(e.endsWith("]"))return"array";throw new Error(`Unsupported type: ${e}`)}}const R=2,j=7,D=10;function P(e){return"function"==typeof e?.getChild}function F(e){switch(e.typeId){case R:case 3:case j:return Float64Array;default:return Array}}function G(e){const{typeId:t}=e;if(t===D)return e=>null==e?e:new Date(e);if(t===R&&e.bitWidth>=64)return e=>null==e?e:Number(e);if(t===j){const t=1/Math.pow(10,e.scale);return e=>null==e?e:z(e,t)}return e=>e}function W(e){const{type:t}=e,{typeId:r}=t;if(r===D){const t=e.length,r=new Array(t);for(let n=0;n<t;++n){const t=e.get(n);r[n]=null==t?null:new Date(t)}return r}if(r===R&&t.bitWidth>=64){const t=e.length,r=new Float64Array(t);for(let n=0;n<t;++n){const t=e.get(n);r[n]=null==t?NaN:Number(t)}return r}if(r===j){const r=1/Math.pow(10,t.scale),n=e.length,s=new Float64Array(n);for(let t=0;t<n;++t){const n=e.get(t);s[t]=null==n?NaN:z(n,r)}return s}return e.toArray()}const V=Array.from({length:8},((e,t)=>Math.pow(2,32*t)));function z(e,t){const r=e.length;let n=0;if(e.signed&&(0|e[r-1])<0){for(let t=0;t<r;++t)n+=~(0|e[t])*V[t];n=-(n+1)}else for(let t=0;t<r;++t)n+=e[t]*V[t];return n*t}const Q={count:u,distinct:e=>u(e).distinct(),max:h,min:f,nulls:e=>u().where(d(e))};async function Y(e,t){return 1===t.length&&"*"==`${t[0].column}`?async function(e,t){const r=await e.query(`DESCRIBE ${l(t)}`);return Array.from(r).map((e=>({table:t,column:e.column_name,sqlType:e.column_type,type:O(e.column_type),nullable:"YES"===e.null})))}(e,t[0].table):(await Promise.all(t.map((t=>async function(e,{table:t,column:n,stats:i}){const o=r.from({source:t}).select({column:n}).groupby(n.aggregate?s`ALL`:[]),[c]=Array.from(await e.query(r.describe(o))),a={table:t,column:`${n}`,sqlType:c.column_type,type:O(c.column_type),nullable:"YES"===c.null};if(!i?.length&&!i?.size)return a;const l=await e.query(function(e,t,n){return r.from(e).select(Array.from(n,(e=>[e,Q[e](t)])))}(t,n,i),{persist:!0});for(let e=0;e<l.numCols;++e){const{name:t}=l.schema.fields[e],r=l.getChildAt(e),n=G(r.type);a[t]=n(r.get(0))}return a}(e,t))))).filter((e=>e))}let H;function J(e){return e?H=e:null==H&&(H=new X),H}class X{constructor(e=w(),t={}){const{logger:r=console,manager:n=B()}=t;this.manager=n,this.logger(r),this.configure(t),this.databaseConnector(e),this.clear()}logger(e){return arguments.length&&(this._logger=e||{debug(){},info(){},log(){},warn(){},error(){}},this.manager.logger(this._logger)),this._logger}configure({cache:e=!0,consolidate:t=!0,indexes:r=!0}){this.manager.cache(e),this.manager.consolidate(t),this.indexes=r}clear({clients:e=!0,cache:t=!0}={}){this.manager.clear(),e&&(this.clients?.forEach((e=>this.disconnect(e))),this.filterGroups?.forEach((e=>e.finalize())),this.clients=new Set,this.filterGroups=new Map),t&&this.manager.cache().clear()}databaseConnector(e){return this.manager.connector(e)}cancel(e){this.manager.cancel(e)}exec(e,{priority:t=U.Normal}={}){return e=Array.isArray(e)?e.join(";\n"):e,this.manager.request({type:"exec",query:e},t)}query(e,{type:t="arrow",cache:r=!0,priority:n=U.Normal,...s}={}){return this.manager.request({type:t,query:e,cache:r,options:s},n)}prefetch(e,t={}){return this.query(e,{...t,cache:!0,priority:U.Low})}createBundle(e,t,r=U.Low){const n={name:e,queries:t};return this.manager.request({type:"create-bundle",options:n},r)}loadBundle(e,t=U.High){const r={name:e};return this.manager.request({type:"load-bundle",options:r},t)}updateClient(e,t,r=U.Normal){return e.queryPending(),this.query(t,{priority:r}).then((t=>e.queryResult(t).update()),(t=>{e.queryError(t),this._logger.error(t)}))}requestQuery(e,t){return this.filterGroups.get(e.filterBy)?.reset(),t?this.updateClient(e,t):e.update()}async connect(e){const{clients:t,filterGroups:r,indexes:n}=this;if(t.has(e))throw new Error("Client already connected.");t.add(e),e.coordinator=this;const s=e.fields();s?.length&&e.fieldInfo(await Y(this,s));const i=e.filterBy;if(i)if(r.has(i))r.get(i).add(e);else{const t=new I(this,i,n);r.set(i,t.add(e))}e.requestQuery()}disconnect(e){const{clients:t,filterGroups:r}=this;t.has(e)&&(t.delete(e),r.get(e.filterBy)?.remove(e),e.coordinator=null)}}class Z{constructor(){this._callbacks=new Map}addEventListener(e,t){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new K});this._callbacks.get(e).callbacks.add(t)}removeEventListener(e,t){const r=this._callbacks.get(e);r&&r.callbacks.delete(t)}willEmit(e,t){return t}emitQueueFilter(){return null}cancel(e){const t=this._callbacks.get(e);t?.queue.clear()}emit(e,t){const r=this._callbacks.get(e)||{};if(r.pending)r.queue.enqueue(t,this.emitQueueFilter(e,t));else{const n=this.willEmit(e,t),{callbacks:s,queue:i}=r;if(s?.size){const t=Promise.allSettled(Array.from(s,(e=>e(n)))).then((()=>{r.pending=null,i.isEmpty()||this.emit(e,i.dequeue())}));r.pending=t}}}}class K{constructor(){this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,t){const r={value:e};if(t&&this.next){let e=this;for(;e.next;)t(e.next.value)?e=e.next:e.next=e.next.next;e.next=r}else this.next=r}dequeue(){const{next:e}=this;return this.next=e?.next,e?.value}}function ee(e,t){return e!==t&&(e instanceof Date&&t instanceof Date?+e!=+t:!Array.isArray(e)||!Array.isArray(t)||function(e,t){if(e.length!==t.length)return!0;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!0;return!1}(e,t))}function te(e){return e instanceof re}class re extends Z{constructor(e){super(),this._value=e}static value(e){return new re(e)}static array(e){if(e.some((e=>te(e)))){const t=new re,r=()=>t.update(e.map((e=>te(e)?e.value:e)));return r(),e.forEach((e=>te(e)?e.addEventListener("value",r):0)),t}return new re(e)}get value(){return this._value}update(e,{force:t}={}){return ee(this._value,e)||t?this.emit("value",e):this.cancel("value"),this}willEmit(e,t){return"value"===e&&(this._value=t),t}}function ne(e){return e instanceof se}class se extends re{static intersect({cross:e=!1}={}){return new se(new ie({cross:e}))}static union({cross:e=!1}={}){return new se(new ie({cross:e,union:!0}))}static single({cross:e=!1}={}){return new se(new ie({cross:e,single:!0}))}static crossfilter(){return new se(new ie({cross:!0}))}constructor(e=new ie){super([]),this._resolved=this._value,this._resolver=e}clone(){const e=new se(this._resolver);return e._value=e._resolved=this._value,e}remove(e){const t=this.clone();return t._value=t._resolved=t._resolver.resolve(this._resolved,{source:e}),t._value.active={source:e},t}get active(){return this.clauses.active}get value(){return this.active?.value}get clauses(){return super.value}get single(){return this._resolver.single}activate(e){this.emit("activate",e)}update(e){return this._resolved=this._resolver.resolve(this._resolved,e,!0),this._resolved.active=e,super.update(this._resolved)}willEmit(e,t){return"value"===e?(this._value=t,this.value):t}emitQueueFilter(e,t){return"value"===e?this._resolver.queueFilter(t):null}skip(e,t){return this._resolver.skip(e,t)}predicate(e,t=!1){const{clauses:r}=this,n=t?null:r.active;return this._resolver.predicate(r,n,e)}}class ie{constructor({union:e,cross:t,single:r}={}){this.union=!!e,this.cross=!!t,this.single=!!r}resolve(e,t,r=!1){const{source:n,predicate:s}=t,i=e.filter((e=>n!==e.source)),o=this.single?[]:i;return this.single&&r&&i.forEach((e=>e.source?.reset?.())),s&&o.push(t),o}skip(e,t){return this.cross&&t?.clients?.has(e)}predicate(e,t,r){const{union:n}=this;if(this.skip(r,t))return;const s=e.filter((e=>!this.skip(r,e))).map((e=>e.predicate));return n&&s.length>1?p(s):s}queueFilter(e){if(this.cross){const t=e.active?.source;return e=>e.active?.source!==t}}}function oe(t="http://localhost:3000/"){return{async query(r){const n=fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return"exec"===r.type?n:"arrow"===r.type?e(n):(await n).json()}}}function ce(e={}){const{duckdb:t,connection:r,...n}=e;let s,i=t,o=r;function c(){return s||(s=(i?Promise.resolve(i):ae(n).then((e=>i=e))).then((e=>e.connect())).then((e=>o=e))),s}async function a(){return o||await c(),o}return{getDuckDB:async function(){return i||await c(),i},getConnection:a,query:async e=>{const{type:t,sql:r}=e,n=await a(),s=await n.query(r);return"exec"===t?void 0:"arrow"===t?s:Array.from(s)}}}async function ae({log:e=!1}={}){const t=m.getJsDelivrBundles(),r=await m.selectBundle(t),n=URL.createObjectURL(new Blob([`importScripts("${r.mainWorker}");`],{type:"text/javascript"})),s=new Worker(n),i=e?new m.ConsoleLogger:new m.VoidLogger,o=new m.AsyncDuckDB(i,s);return await o.instantiate(r.mainModule,r.pthreadWorker),URL.revokeObjectURL(n),o}function le(){const e=new Set;let t,r=new Promise((e=>t=e));return{pending(t){e.add(t)},ready:t=>(e.delete(t),0===e.size),resolve(){r=new Promise((e=>{t(),t=e}))},get promise(){return r}}}export{X as Coordinator,v as MosaicClient,re as Param,U as Priority,se as Selection,F as convertArrowArrayType,W as convertArrowColumn,G as convertArrowValue,J as coordinator,ee as distinct,P as isArrowTable,te as isParam,ne as isSelection,oe as restConnector,w as socketConnector,le as synchronizer,g as throttle,ce as wasmConnector};export default null;
